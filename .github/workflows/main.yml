name: Linux VPS with SSH + Tailscale

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Update system
      run: sudo apt update && sudo apt upgrade -y

    - name: Install SSH server
      run: |
        sudo apt install -y openssh-server
        sudo systemctl enable ssh
        sudo systemctl start ssh

    - name: Create SSH user
      run: |
        sudo useradd -m -s /bin/bash kali
        echo "kali:Password123!" | sudo chpasswd
        sudo usermod -aG sudo kali

    - name: Install Tailscale
      run: |
        curl -fsSL https://tailscale.com/install.sh | sh
        sudo tailscale up --authkey ${{ secrets.TS_KEY }} --hostname kali-vps --ssh
